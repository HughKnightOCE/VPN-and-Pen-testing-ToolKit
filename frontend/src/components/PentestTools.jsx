import React, { useState } from 'react'
import axios from 'axios'
import './PentestTools.css'

function PentestTools() {
  const [activeTab, setActiveTab] = useState('sql')
  const [testUrl, setTestUrl] = useState('')
  const [testHost, setTestHost] = useState('')
  const [results, setResults] = useState(null)
  const [loading, setLoading] = useState(false)
  const [error, setError] = useState(null)

  const testSQLInjection = async () => {
    if (!testUrl) {
      setError('Please enter a URL')
      return
    }

    setLoading(true)
    setError(null)
    try {
      const response = await axios.post('/api/pentest/sql-injection', { url: testUrl })
      setResults(response.data)
    } catch (err) {
      setError(err.response?.data?.error || 'SQL injection test failed')
    }
    setLoading(false)
  }

  const testXSS = async () => {
    if (!testUrl) {
      setError('Please enter a URL')
      return
    }

    setLoading(true)
    setError(null)
    try {
      const response = await axios.post('/api/pentest/xss-test', { url: testUrl })
      setResults(response.data)
    } catch (err) {
      setError(err.response?.data?.error || 'XSS test failed')
    }
    setLoading(false)
  }

  const scanPorts = async () => {
    if (!testHost) {
      setError('Please enter a host')
      return
    }

    setLoading(true)
    setError(null)
    try {
      const response = await axios.post('/api/pentest/port-scan', { 
        host: testHost,
        ports: '1-1000'
      })
      setResults(response.data)
    } catch (err) {
      setError(err.response?.data?.error || 'Port scan failed')
    }
    setLoading(false)
  }

  const analyzeCert = async () => {
    if (!testHost) {
      setError('Please enter a host')
      return
    }

    setLoading(true)
    setError(null)
    try {
      const response = await axios.post('/api/pentest/cert-analyze', { 
        host: testHost,
        port: 443
      })
      setResults(response.data)
    } catch (err) {
      setError(err.response?.data?.error || 'Certificate analysis failed')
    }
    setLoading(false)
  }

  return (
    <div className="pentest-tools">
      <h2>Pentesting Tools</h2>

      <div className="tool-tabs">
        <button 
          className={`tab-btn ${activeTab === 'sql' ? 'active' : ''}`}
          onClick={() => setActiveTab('sql')}
        >
          SQL Injection
        </button>
        <button 
          className={`tab-btn ${activeTab === 'xss' ? 'active' : ''}`}
          onClick={() => setActiveTab('xss')}
        >
          XSS Test
        </button>
        <button 
          className={`tab-btn ${activeTab === 'port' ? 'active' : ''}`}
          onClick={() => setActiveTab('port')}
        >
          Port Scan
        </button>
        <button 
          className={`tab-btn ${activeTab === 'cert' ? 'active' : ''}`}
          onClick={() => setActiveTab('cert')}
        >
          Certificate
        </button>
      </div>

      <div className="tool-content">
        {activeTab === 'sql' && (
          <div className="tool-panel">
            <h3>SQL Injection Tester</h3>
            <p className="tool-desc">Test URLs for SQL injection vulnerabilities</p>
            <div className="input-group">
              <input
                type="text"
                placeholder="Enter URL (e.g., http://target.com/page?id=1)"
                value={testUrl}
                onChange={(e) => setTestUrl(e.target.value)}
                className="input-field"
              />
              <button onClick={testSQLInjection} disabled={loading} className="btn-primary">
                {loading ? 'Testing...' : 'Test'}
              </button>
            </div>
          </div>
        )}

        {activeTab === 'xss' && (
          <div className="tool-panel">
            <h3>XSS Vulnerability Tester</h3>
            <p className="tool-desc">Test URLs for Cross-Site Scripting vulnerabilities</p>
            <div className="input-group">
              <input
                type="text"
                placeholder="Enter URL (e.g., http://target.com/search?q=test)"
                value={testUrl}
                onChange={(e) => setTestUrl(e.target.value)}
                className="input-field"
              />
              <button onClick={testXSS} disabled={loading} className="btn-primary">
                {loading ? 'Testing...' : 'Test'}
              </button>
            </div>
          </div>
        )}

        {activeTab === 'port' && (
          <div className="tool-panel">
            <h3>Port Scanner</h3>
            <p className="tool-desc">Scan host for open ports and services</p>
            <div className="input-group">
              <input
                type="text"
                placeholder="Enter host or IP (e.g., scanme.nmap.org)"
                value={testHost}
                onChange={(e) => setTestHost(e.target.value)}
                className="input-field"
              />
              <button onClick={scanPorts} disabled={loading} className="btn-primary">
                {loading ? 'Scanning...' : 'Scan'}
              </button>
            </div>
          </div>
        )}

        {activeTab === 'cert' && (
          <div className="tool-panel">
            <h3>SSL/TLS Certificate Analyzer</h3>
            <p className="tool-desc">Analyze certificate vulnerabilities</p>
            <div className="input-group">
              <input
                type="text"
                placeholder="Enter host (e.g., google.com)"
                value={testHost}
                onChange={(e) => setTestHost(e.target.value)}
                className="input-field"
              />
              <button onClick={analyzeCert} disabled={loading} className="btn-primary">
                {loading ? 'Analyzing...' : 'Analyze'}
              </button>
            </div>
          </div>
        )}
      </div>

      {results && (
        <div className="results-panel">
          <h3>Results</h3>
          <div className="results-content">
            {results.vulnerable !== undefined && (
              <div className={`result-badge ${results.vulnerable ? 'vulnerable' : 'safe'}`}>
                {results.vulnerable ? '⚠️ VULNERABLE' : '✅ SAFE'}
              </div>
            )}
            {results.secure !== undefined && (
              <div className={`result-badge ${!results.secure ? 'vulnerable' : 'safe'}`}>
                {!results.secure ? '⚠️ INSECURE' : '✅ SECURE'}
              </div>
            )}
            <pre className="results-json">
              {JSON.stringify(results, null, 2)}
            </pre>
          </div>
        </div>
      )}

      {error && <div className="error-message">{error}</div>}
    </div>
  )
}

export default PentestTools
